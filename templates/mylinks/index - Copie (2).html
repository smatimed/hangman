<!-- { % load static %} -->
<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>My Links</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="{ % static 'bootstrap513-dist/css/bootstrap.min.css' %}"> -->
    <style>
        body {
            background-color: rgb(239, 239, 239);
        }

        .link-active {
            color: #0d6efd;
            /* Bleu Bootstrap */
            font-weight: bold;
        }

        .link-inactive {
            color: gray;
            text-decoration: line-through;
        }

        .icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }

        .link-container {
            margin-bottom: 1rem;
        }

        .description {
            margin: 0.25rem 0;
        }

        .type-label {
            font-size: 0.9rem;
            color: #555;
        }

        .accordion-item {
            margin-bottom: 1rem;
            /* espace de 16px */
            border-radius: 0.5rem;
            /* arrondi pour plus de lisibilité */
            overflow: hidden;
            /* garde l'arrondi visible */
        }
    </style>
</head>

<body>
    <div class="container py-4">
        <h1 class="mb-4">Mes Liens Intéressants</h1>

        <!-- Bouton pour tout ouvrir/fermer -->
        <div class="mb-3">
            <button id="toggleAll" class="btn btn-primary">Tout ouvrir</button>
        </div>

        <div class="accordion" id="linksAccordion"></div>
    </div>

    <script>
        // ----------- Tableau de liens
        const liens = [
            {
                categorie: "Programmation",
                libelle: "MDN Web Docs",
                lien: "https://developer.mozilla.org/",
                description: "Documentation complète pour les développeurs web.",
                type: "Gratuit",
                icone: "https://developer.mozilla.org/favicon-48x48.cbbd161b.png",
                actif: true
            },
            {
                categorie: "Programmation",
                libelle: "Stack Overflow",
                lien: "https://stackoverflow.com/",
                description: "Communauté de développeurs pour poser des questions et trouver des réponses.",
                type: "Gratuit",
                icone: "https://cdn.sstatic.net/Sites/stackoverflow/company/img/logos/so/so-icon.png",
                actif: true
            },
            {
                categorie: "Design",
                libelle: "Dribbble",
                lien: "https://dribbble.com/",
                description: "Plateforme pour découvrir et partager des travaux de design.",
                type: "Freemium",
                icone: "https://cdn.worldvectorlogo.com/logos/dribbble-icon-1.svg",
                actif: false
            }
        ];

        // ----------- Regroupement par catégorie
        const categories = {};
        liens.forEach(item => {
            if (!categories[item.categorie]) {
                categories[item.categorie] = [];
            }
            categories[item.categorie].push(item);
        });

        const accordion = document.getElementById("linksAccordion");

        let index = 0;
        for (const [categorie, items] of Object.entries(categories)) {
            index++;
            const collapseId = `collapse${index}`;
            const headingId = `heading${index}`;

            // Accordéon pour chaque catégorie
            const accordionItem = document.createElement("div");
            accordionItem.className = "accordion-item";

            accordionItem.innerHTML = `
      <h2 class="accordion-header" id="${headingId}">
        <button class="accordion-button ${index > 1 ? "collapsed" : ""}" type="button" 
          data-bs-toggle="collapse" data-bs-target="#${collapseId}" 
          aria-expanded="${index === 1}" aria-controls="${collapseId}">
          ${categorie}
        </button>
      </h2>
      <div id="${collapseId}" class="accordion-collapse collapse ${index === 1 ? "show" : ""}" 
           aria-labelledby="${headingId}" data-bs-parent="#linksAccordion">
        <div class="accordion-body" id="body-${categorie}"></div>
      </div>
    `;

            accordion.appendChild(accordionItem);

            // Remplir les liens
            const bodyDiv = accordionItem.querySelector(`#body-${categorie}`);
            items.forEach(link => {
                const linkDiv = document.createElement("div");
                linkDiv.className = "link-container";

                linkDiv.innerHTML = `
        <div>
          <img src="${link.icone}" class="icon" alt="icon">
          <a href="${link.lien}" target="_blank" class="${link.actif ? "link-active" : "link-inactive"}">
            ${link.libelle}
          </a>
        </div>
        <div>
          <p class="description">${link.description}</p>
          <label class="type-label">Type : ${link.type}</label>
        </div>
      `;

                bodyDiv.appendChild(linkDiv);
            });
        };


        // ----------- Fonction pour ouvrir/fermer tous les accordions
        // Fonction pour ouvrir/fermer tous les accordions
        const toggleButton = document.getElementById("toggleAll");
        let allOpen = false;

        toggleButton.addEventListener("click", () => {
            const allCollapses = accordion.querySelectorAll(".accordion-collapse");

            if (!allOpen) {
                // Ouvrir tous
                allCollapses.forEach(collapse => {
                    console.log(collapse);
                    const bsCollapse = bootstrap.Collapse.getOrCreateInstance(collapse, { toggle: false });
                    bsCollapse.show(); // Forcer ouverture
                });
                allOpen = true;
                toggleButton.textContent = "Tout fermer";
            } else {
                // Fermer tous
                allCollapses.forEach(collapse => {
                    const bsCollapse = bootstrap.Collapse.getOrCreateInstance(collapse, { toggle: false });
                    bsCollapse.hide(); // Forcer fermeture
                });
                allOpen = false;
                toggleButton.textContent = "Tout ouvrir";
            }
        });

    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- <script src="{ % static 'bootstrap513-dist/js/bootstrap.bundle.min.js' %}"></script> -->
</body>

</html>